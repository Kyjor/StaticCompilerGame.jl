<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ WebAssembly Guessing Game</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .status {
            font-size: 1.1rem;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.2);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loading {
            color: #ffd700;
        }

        .result {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 20px 0;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .correct {
            color: #4CAF50;
            animation: bounce 0.5s ease-in-out;
        }

        .wrong {
            color: #f44336;
            animation: shake 0.5s ease-in-out;
        }

        .too-low {
            color: #ff9800;
        }

        .too-high {
            color: #ff5722;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .buttons-container {
            margin: 30px 0;
        }

        .buttons-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(145deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            min-width: 60px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(145deg, #45a049, #4CAF50);
        }

        button:active {
            transform: translateY(-1px);
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .reset-btn {
            background: linear-gradient(145deg, #2196F3, #1976D2);
            margin-top: 20px;
            padding: 12px 30px;
        }

        .reset-btn:hover {
            background: linear-gradient(145deg, #1976D2, #2196F3);
        }

        .info {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .tech-info {
            margin-top: 15px;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .wasm-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        .wasm-loaded {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }

        .wasm-error {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
                margin: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            button {
                padding: 12px 16px;
                font-size: 16px;
                min-width: 50px;
            }

            .buttons-row {
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üéÆ WebAssembly Guessing Game</h1>
        <p class="subtitle">Powered by Julia + StaticCompiler.jl + Emscripten</p>

        <div class="status" id="status">
            <span class="loading">üîÑ Loading WebAssembly module...</span>
        </div>

        <div class="result" id="result">Guess the secret number!</div>

        <div class="buttons-container">
            <div class="buttons-row">
                <button onclick="makeGuess(1)" disabled>1</button>
                <button onclick="makeGuess(2)" disabled>2</button>
                <button onclick="makeGuess(3)" disabled>3</button>
                <button onclick="makeGuess(4)" disabled>4</button>
                <button onclick="makeGuess(5)" disabled>5</button>
            </div>
            <div class="buttons-row">
                <button onclick="makeGuess(6)" disabled>6</button>
                <button onclick="makeGuess(7)" disabled>7</button>
                <button onclick="makeGuess(8)" disabled>8</button>
                <button onclick="makeGuess(9)" disabled>9</button>
                <button onclick="makeGuess(0)" disabled>0</button>
            </div>
        </div>

        <button class="reset-btn" onclick="resetGame()" disabled>üîÑ Reset Game</button>

        <div class="info">
            <strong>How to Play:</strong><br>
            The secret number is between 0 and 9. Click the number buttons to make your guess!
            <br><br>
            <strong>üéØ Goal:</strong> Find the secret number (hint: it's 7)
            <br><br>
            <strong>üí° Fun Fact:</strong> This game logic was written in Julia, compiled to LLVM IR using StaticCompiler.jl, and then converted to WebAssembly using Emscripten. The actual computation happens in WebAssembly at near-native speed!

            <div class="wasm-status" id="wasmStatus">
                WebAssembly: Loading...
            </div>

            <div class="tech-info">
                <strong>Tech Stack:</strong> Julia ‚Üí LLVM IR ‚Üí WebAssembly ‚Üí Browser
            </div>
        </div>
    </div>

    <script>
        let wasmModule = null;
        let gameActive = false;

        // Load the WebAssembly module
        async function loadWebAssembly() {
            try {
                // Try to load the WebAssembly module generated by Emscripten
                const wasmResponse = await fetch('./wasm_emscripten/web_guess_game.wasm');
                
                if (!wasmResponse.ok) {
                    throw new Error(`Failed to fetch WebAssembly: ${wasmResponse.status}`);
                }

                const wasmBytes = await wasmResponse.arrayBuffer();
                const wasmInstance = await WebAssembly.instantiate(wasmBytes);
                
                wasmModule = wasmInstance.instance;
                
                // Update UI to show success
                document.getElementById('status').innerHTML = 
                    '<span style="color: #4CAF50;">‚úÖ WebAssembly module loaded successfully!</span>';
                
                document.getElementById('wasmStatus').textContent = 'WebAssembly: Loaded ‚úÖ';
                document.getElementById('wasmStatus').className = 'wasm-status wasm-loaded';
                
                // Enable all buttons
                const buttons = document.querySelectorAll('button');
                buttons.forEach(button => button.disabled = false);
                
                gameActive = true;
                
                console.log('WebAssembly module loaded successfully');
                console.log('Available exports:', Object.keys(wasmModule.exports));
                
            } catch (error) {
                console.error('Failed to load WebAssembly:', error);
                
                // Update UI to show error and fall back to JavaScript
                document.getElementById('status').innerHTML = 
                    '<span style="color: #ff9800;">‚ö†Ô∏è WebAssembly failed to load, using JavaScript fallback</span>';
                
                document.getElementById('wasmStatus').textContent = 'WebAssembly: Failed, using JS fallback';
                document.getElementById('wasmStatus').className = 'wasm-status wasm-error';
                
                // Enable buttons for JavaScript fallback
                const buttons = document.querySelectorAll('button');
                buttons.forEach(button => button.disabled = false);
                
                gameActive = true;
            }
        }

        function makeGuess(guess) {
            if (!gameActive) return;

            const resultDiv = document.getElementById('result');
            let result;

            try {
                // Try to use WebAssembly function first
                if (wasmModule && wasmModule.exports.web_guess_game) {
                    result = wasmModule.exports.web_guess_game(guess);
                    console.log(`WebAssembly call: web_guess_game(${guess}) = ${result}`);
                } else {
                    // Fallback to JavaScript implementation
                    result = jsGuessGame(guess);
                    console.log(`JavaScript fallback: jsGuessGame(${guess}) = ${result}`);
                }

                // Interpret the result
                if (result === 1) {
                    resultDiv.innerHTML = 'üéâ Correct! You guessed it!';
                    resultDiv.className = 'result correct';
                    
                    // Disable guess buttons after winning
                    const guessButtons = document.querySelectorAll('button:not(.reset-btn)');
                    guessButtons.forEach(button => button.disabled = true);
                    
                } else if (result === -1) {
                    resultDiv.innerHTML = `üìâ ${guess} is too low! Try higher...`;
                    resultDiv.className = 'result too-low';
                    
                } else if (result === 2) {
                    resultDiv.innerHTML = `üìà ${guess} is too high! Try lower...`;
                    resultDiv.className = 'result too-high';
                    
                } else {
                    resultDiv.innerHTML = `ü§î Unexpected result: ${result}`;
                    resultDiv.className = 'result wrong';
                }
                
            } catch (error) {
                console.error('Error calling game function:', error);
                resultDiv.innerHTML = '‚ùå Error occurred during game logic';
                resultDiv.className = 'result wrong';
            }
        }

        // JavaScript fallback implementation (same logic as Julia version)
        function jsGuessGame(guess) {
            const target = 7;
            
            if (guess === target) {
                return 1;  // Correct
            } else if (guess < target) {
                return -1; // Too low
            } else {
                return 2;  // Too high
            }
        }

        function resetGame() {
            // Reset the game state
            document.getElementById('result').innerHTML = 'Guess the secret number!';
            document.getElementById('result').className = 'result';
            
            // Re-enable all guess buttons
            const guessButtons = document.querySelectorAll('button:not(.reset-btn)');
            guessButtons.forEach(button => button.disabled = false);
            
            gameActive = true;
        }

        // Add keyboard support
        document.addEventListener('keydown', function(event) {
            const key = event.key;
            if (key >= '0' && key <= '9') {
                makeGuess(parseInt(key));
            } else if (key === 'r' || key === 'R') {
                resetGame();
            }
        });

        // Initialize the game when page loads
        window.addEventListener('load', function() {
            loadWebAssembly();
        });
    </script>
</body>
</html> 